id: taxi_backfill_2021
namespace: zoomcamp

description: |
  Convenience flow to ingest 2021-01..2021-07 for both green & yellow.
  This is an alternative to Kestra UI "Backfill" on the schedule triggers.

tasks:
  - id: foreach_combo
    type: io.kestra.plugin.core.flow.ForEach
    values:
      - { taxi: green,  year: "2021", month: "01" }
      - { taxi: green,  year: "2021", month: "02" }
      - { taxi: green,  year: "2021", month: "03" }
      - { taxi: green,  year: "2021", month: "04" }
      - { taxi: green,  year: "2021", month: "05" }
      - { taxi: green,  year: "2021", month: "06" }
      - { taxi: green,  year: "2021", month: "07" }
      - { taxi: yellow, year: "2021", month: "01" }
      - { taxi: yellow, year: "2021", month: "02" }
      - { taxi: yellow, year: "2021", month: "03" }
      - { taxi: yellow, year: "2021", month: "04" }
      - { taxi: yellow, year: "2021", month: "05" }
      - { taxi: yellow, year: "2021", month: "06" }
      - { taxi: yellow, year: "2021", month: "07" }
    tasks:
      - id: ingest_one
        type: io.kestra.plugin.core.flow.Subflow
        flowId: taxi_ingest
        namespace: zoomcamp
        inputs:
          taxi: "{{ fromJson(taskrun.value).taxi }}"
          year: "{{ fromJson(taskrun.value).year }}"
          month: "{{ fromJson(taskrun.value).month }}"
